{% extends 'base.html.twig' %}

{% block title %}Hello ActivitesController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

 <h1 style="margin-left: 1rem">News :</h1>

<br>

{% if category is defined %}
    <form action="{{ path('app_actualites') }}" method="get">
        <select name="category" style="margin-left: 1rem">
            {% for category in loadFeed|keys %}
                <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
        </select>
        <button type="submit" style="margin-left: 1rem">Rechercher</button>
    </form>
{% endif %}

{% set items_per_page = 6 %}
{% set page_number = app.request.query.get('page', 1) %}

{% if category is defined %}
    {% if category == 'Infos trafic' %}
        <h2 style="margin-left: 1rem">{{ category }}</h2>
        <div style="display: grid; row-gap: 60px; grid-template-columns: 15fr 15fr 15fr; margin-right: 20px;">
            {% for item in loadFeed[category] | slice((page_number - 1) * items_per_page, items_per_page) %}
            <div class="card" style=" padding: 3rem; margin: 3rem;">
                <div class="card-body row"> 
                    <h3 class="card-title">{{ item.title }}</h3>
                    <p class="card-text">{{ item.desc }}</p>
                    <p class="card-text">{{ item.date }}</p>
                    <a href="{{ item.link }}" class="btn btn-primary" style="width: 8rem; background-color: red; border: 1px solid red">En savoir plus</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if category == 'Infos trafic' %}
    ...
    {% set num_pages = (loadFeed[category] | length + items_per_page - 1) / items_per_page | round(0, 'ceil') %}
    {% if page_number > 1 %}
        <a href="{{ path('app_actualites', {'category': category, 'page': page_number - 1}) }}" style="margin-left: 1rem">Précédent</a>
    {% endif %}
    {% if page_number < num_pages %}
        <a href="{{ path('app_actualites', {'category': category, 'page': page_number + 1}) }}" style="margin-left: 1rem">Suivant</a>
    {% endif %}
{% else %}
    ...
    {% set num_pages = (items | length + items_per_page - 1) / items_per_page | round(0, 'ceil') %}
    {% if page_number > 1 %}
        <a href="{{ path('app_actualites', {'category': category, 'page': page_number - 1}) }}" style="margin-left: 1rem">Précédent</a>
    {% endif %}
    {% if page_number < num_pages %}
        <a href="{{ path('app_actualites', {'category': category, 'page': page_number + 1}) }}" style="margin-left: 1rem">Suivant</a>
    {% endif %}
{% endif %}

    {% else %}

    {% for category, items in loadFeed %}
            {% if category == 'Trafic transport en commun' %}
                <h2 style="margin-left: 1rem">{{ category }}</h2>
                <div style="display: grid; row-gap: 60px; grid-template-columns: 15fr 15fr 15fr; margin-right: 20px;">
                    {% for item in items %}
                        {% if attribute(item, 'categ') == category %}
                        <div class="card" style=" padding: 3rem; margin: 3rem;">
                            <div class="card-body row"> 
                                <h3 class="card-title">{{ item.title }}</h3>
                                <p class="card-text">{{ item.desc }}</p>
                                <p class="card-text">{{ item.date }}</p>
                                <a href="{{ item.link }}" class="btn btn-primary" style="width: 8rem; background-color: red; border: 1px solid red">En savoir plus</a>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}
        {% endfor %}
    {% endif %}
{% endif %}

{% endblock %}
